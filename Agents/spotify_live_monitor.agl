AGENT SpotifyLiveMonitor {

    STATE Inicio {
        ACTION Log "=== Iniciando Monitor de Spotify ==="
        SUCCESS CheckSpotify
        FAILURE End
    }

    STATE CheckSpotify {
        ACTION Log "Consultando cancion actual..."
        SUCCESS LlamadaApi
        FAILURE End
    }

    STATE LlamadaApi {
        ACTION HttpGetToken "https://api.spotify.com/v1/me/player/currently-playing" "BQAKF-...1RAW4O"
        SUCCESS ValidarRespuesta
        FAILURE ErrorApi
    }

    STATE ValidarRespuesta {
        ACTION SetVar "raw_track_data"
        SUCCESS GuardarDisco
        FAILURE ErrorVar
    }

    STATE GuardarDisco {
        ACTION WriteBuffer "agentTxtExample/spotify_history.json"
        SUCCESS EsperarLoop
        FAILURE ErrorIO
    }

    STATE EsperarLoop {
        ACTION Log "Esperando 10 segundos..."
        SUCCESS DelayLoop
        FAILURE End
    }

    STATE DelayLoop {
        ACTION Delay 10
        SUCCESS CheckSpotify
        FAILURE End
    }

    STATE ErrorApi {
        ACTION Log "Error: Token invalido o no hay musica sonando."
        SUCCESS DelayError
        FAILURE End
    }

    STATE DelayError {
        ACTION Delay 10
        SUCCESS CheckSpotify
        FAILURE End
    }

    STATE ErrorVar {
        ACTION Log "Error de variable."
        SUCCESS End
        FAILURE End
    }

    STATE ErrorIO {
        ACTION Log "Error de disco."
        SUCCESS End
        FAILURE End
    }
}